# DRIVETA 運送業務システム 要件定義書

## 1. システム概要

### 1.1 プロジェクト名
**DRIVETA** - 運送業務管理システム

### 1.2 目的
これまで紙とExcelで管理していた運送業務をデジタル化し、データの一元管理と分析を可能にすることで業務効率化を図る。

### 1.3 対象業務
- 車両管理
- 整備記録管理
- 点検スケジュール管理
- ETCデータ管理
- 従業員管理
- 荷物・配送データ管理

## 2. 技術仕様

### 2.1 アーキテクチャ
- **フロントエンド**: Next.js (React)
- **バックエンド**: Flask (Python)
- **データベース**: Supabase (PostgreSQL)
- **認証**: Flask-Login
- **UI**: React Bootstrap + Tailwind CSS

### 2.2 ディレクトリ構成
```
DRIVETA/
├── frontend/                      # Next.js用のディレクトリ 
│   ├── src/
│   │   ├── app/
│   │   │   ├── maintenance/       # 整備管理ページ
│   │   │   ├── vehicles/          # 車両管理ページ
│   │   │   └── page.js            # ダッシュボード
│   │   ├── components/
│   │   │   ├── dashboard/         # ダッシュボード用コンポーネント
│   │   │   ├── maintenance/       # 整備管理用コンポーネント
│   │   │   ├── ui/                # 共通UIコンポーネント
│   │   │   └── vehicles/          # 車両管理用コンポーネント
│   │   └── utils/                 # ユーティリティ関数
│
├── backend/                       # Flask用のディレクトリ
│   ├── app/                       # APIモジュール用のディレクトリ
│   │   ├── auth/                  # 認証処理モジュール
│   │   ├── etc/                   # ETCデータ管理用モジュール
│   │   ├── vehicle/               # 車両データ管理用モジュール
│   │   ├── maintenance/           # 整備記録管理用モジュール
│   │   ├── employee/              # 従業員管理用モジュール
│   │   └── Hluggage/              # 荷物・配送データ管理用モジュール
│   └── migrations/                # データベースマイグレーション
```

## 3. 機能要件

### 3.1 ダッシュボード機能
- **概要表示**
  - 車両総数、運行中車両数、整備中車両数の表示
  - 未対応アラート数の表示
- **アラート管理**
  - 整備期限切れアラート
  - 車検期限アラート
  - 点検期限アラート
- **誕生日管理**
  - 従業員の近日中の誕生日表示
- **配送スケジュール**
  - 今週の配送予定表示

### 3.2 車両管理機能
- **車両情報管理**
  - 車両登録・編集・削除
  - ナンバープレート、車台番号、型式等の管理
  - 車検有効期限の管理
  - 車両ステータス管理（運行中/整備中/待機中/廃車）
- **車両一覧表示**
  - 検索・フィルタリング機能
  - ステータス別表示
- **車両詳細表示**
  - 基本情報表示
  - 整備履歴表示
  - 車検期限アラート表示

### 3.3 整備記録管理機能
- **点検予定管理**
  - 点検予定の登録・編集・削除
  - カレンダー表示・リスト表示
  - 点検種類管理（車検/3ヶ月点検/オイル交換等）
  - 整備状態管理（予定/進行中/完了/未実施）
- **点検実績管理**
  - 点検完了処理
  - 詳細項目の記録
  - 費用・部品使用記録
  - 担当者記録
- **自動スケジュール生成**
  - 車検有効期限からの逆算
  - 定期点検の自動生成
  - 過去履歴からの次回予定計算
- **アラート機能**
  - 期限切れ点検の通知
  - 車検期限アラート
  - 今後の点検予定表示

### 3.4 従業員管理機能
- **従業員情報管理**
  - 従業員登録・編集
  - 部署・役職管理
  - 運転手・整備士フラグ管理
  - 免許情報管理
- **誕生日管理**
  - 近日中の誕生日表示
  - 月別誕生日カレンダー

### 3.5 ETCデータ管理機能
- **利用履歴管理**
  - ETCカード別利用履歴
  - 車両別利用履歴
  - 区間別料金管理
- **CSVインポート機能**
  - ETCデータの一括取り込み
  - データ検証・エラーハンドリング
- **統計・分析機能**
  - 月別利用統計
  - 車両別利用統計
  - 区間別利用統計

### 3.6 荷物・配送データ管理機能
- **積込量データ管理**
  - 日別積込量記録
  - コース別積込量管理
  - クレート種別管理
- **配送実績管理**
  - 配送完了記録
  - 重量・パレット数計算
  - 配送効率分析

### 3.7 認証・権限管理機能
- **ユーザー認証**
  - ログイン・ログアウト機能
  - セッション管理
- **権限管理**
  - 管理者・一般ユーザー権限
  - 機能別アクセス制御

## 4. データベース設計

### 4.1 主要テーブル

#### 車両テーブル (vehicles)
- 基本情報: ナンバープレート、車台番号、型式等
- 登録情報: 初年度登録、車検有効期限
- ステータス情報: 運行状態

#### 整備管理テーブル群
- **maintenance_types**: 点検種類マスタ
- **maintenance_statuses**: 整備状態マスタ
- **maintenance_schedules**: 点検予定・実績
- **maintenance_details**: 点検詳細項目
- **maintenance_files**: 整備関連ファイル

#### 従業員テーブル (employees)
- 基本情報: 氏名、部署、役職
- 権限情報: 運転手フラグ、整備士フラグ
- 免許情報: 免許種別、有効期限

#### ETCテーブル (etc_usage)
- 利用情報: 利用日時、区間、料金
- 車両・カード情報

#### 荷物管理テーブル群
- **loading_data**: 積込量データ
- **courses**: コースマスタ
- **crate_weights**: クレート重量マスタ

## 5. API設計

### 5.1 認証API
```
POST /api/auth/login     # ログイン
POST /api/auth/logout    # ログアウト
GET  /api/auth/status    # 認証状態確認
```

### 5.2 車両管理API
```
GET    /api/vehicles/              # 車両一覧取得
GET    /api/vehicles/{id}/         # 車両詳細取得
POST   /api/vehicles/              # 車両登録
PUT    /api/vehicles/{id}/         # 車両更新
DELETE /api/vehicles/{id}/         # 車両削除
```

### 5.3 整備管理API
```
GET  /api/maintenance/types/                    # 点検種類一覧
GET  /api/maintenance/statuses/                 # 整備状態一覧
GET  /api/maintenance/schedules/                # 点検予定一覧
POST /api/maintenance/schedules/                # 点検予定登録
GET  /api/maintenance/schedules/{id}/           # 点検予定詳細
PUT  /api/maintenance/schedules/{id}/           # 点検予定更新
POST /api/maintenance/schedules/{id}/complete/  # 点検完了処理
GET  /api/maintenance/summary/                  # 整備概要取得
GET  /api/maintenance/calendar/                 # カレンダーデータ取得
POST /api/maintenance/generate-schedules/       # 自動スケジュール生成
```

### 5.4 従業員管理API
```
GET  /api/employee/              # 従業員一覧取得
GET  /api/employee/{id}/         # 従業員詳細取得
POST /api/employee/              # 従業員登録
GET  /api/employee/birthday_soon # 近日誕生日取得
```

### 5.5 ETCデータAPI
```
GET  /api/etc/           # ETC利用データ一覧
POST /api/etc/           # ETC利用データ登録
POST /api/etc/import     # CSV一括インポート
```

## 6. UI/UX要件

### 6.1 デザイン原則
- **レスポンシブデザイン**: モバイル・タブレット対応
- **直感的な操作**: 紙ベースからの移行を考慮した分かりやすいUI
- **視認性**: 重要な情報（アラート等）の強調表示

### 6.2 主要画面
- **ダッシュボード**: 重要指標とアラートの一覧表示
- **車両一覧**: 検索・フィルタ機能付き車両リスト
- **車両詳細**: タブ形式での情報表示
- **点検カレンダー**: 月表示・週表示・リスト表示の切り替え
- **点検フォーム**: ステップ形式での入力支援

### 6.3 カラーリング
- **成功**: 緑色（運行中、完了等）
- **警告**: 黄色（期限近づき、整備中等）
- **危険**: 赤色（期限切れ、緊急等）
- **情報**: 青色（待機中、予定等）

## 7. 非機能要件

### 7.1 性能要件
- **レスポンス時間**: 一般的な操作で3秒以内
- **同時接続数**: 最大50ユーザー
- **データ保持期間**: 10年間

### 7.2 セキュリティ要件
- **認証**: セッションベース認証
- **データ暗号化**: 通信時のHTTPS使用
- **アクセス制御**: 役割ベースのアクセス制御

### 7.3 可用性要件
- **稼働率**: 99%以上
- **バックアップ**: 日次自動バックアップ
- **災害対策**: クラウドベースでの冗長化

## 8. 開発・運用要件

### 8.1 開発環境
- **バージョン管理**: Git
- **CI/CD**: 自動テスト・デプロイメント
- **環境**: 開発・ステージング・本番環境の分離

### 8.2 データ移行
- **既存Excelデータ**: CSVインポート機能での移行
- **検証機能**: データ整合性チェック
- **段階的移行**: 機能別の段階的導入

### 8.3 教育・サポート
- **ユーザーマニュアル**: 機能別操作手順書
- **研修計画**: 段階的なユーザー研修
- **サポート体制**: 運用開始後のサポート体制

## 9. 今後の拡張予定

### 9.1 短期拡張
- **通知機能**: メール・プッシュ通知
- **レポート機能**: PDF出力・Excel出力
- **API連携**: 外部システムとの連携

### 9.2 長期拡張
- **モバイルアプリ**: 現場作業用アプリ
- **AI分析**: 故障予測・最適化提案
- **IoT連携**: 車両センサーデータ連携

---

この要件定義書は、提供されたコードファイルから分析した現在の実装状況を基に作成されています。実際の要件に応じて調整・追加を行ってください。